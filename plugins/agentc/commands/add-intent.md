---
description: "Add a new intent (WOOP commitment) with milestones"
arguments:
  - name: goal-id
    description: "The goal ID to add an intent for (e.g., g1)"
    required: false
allowed-tools:
  - Read
  - Write
  - Edit
  - Glob
  - Grep
  - Bash
  - AskUserQuestion
---

You are adding a new INTENT to the AgentC system.

**Intents are concrete WOOP commitments with milestones. Tasks are dynamically generated by /next.**

## Directory Detection

Use `agentc/` as `$DIR`. Load `$DIR/agentc.json`.

## STEP 0: Identify Target Goal

1. If goal-id provided: Validate it exists in agentc.json goals array
2. If no goal-id provided:
   - Show active goals
   - Ask user which goal this intent is for
3. **Check for existing active intent:**
   - If goal already has an active intent: Warn user
   - Only ONE active intent per goal at a time

## STEP 1: Analyze Codebase First

**Before gathering WOOP information:**
- Check for `stack.md` in project root
- Analyze current codebase state
- Understand what's implemented vs missing
- This grounds the intent in reality

**Announce:** "I'm analyzing the codebase to ground this intent in reality."

## STEP 2: Gather WOOP Information

Use AskUserQuestion (one question at a time):

1. **Wish**: What specific outcome do you want to achieve?
2. **Outcome**: What are the acceptance criteria? (done when statements)
3. **Obstacles**: What blocks might prevent success?
4. **Plan**: If-then contingency rules for each obstacle
5. **Deadline**: When must this be complete?

## STEP 3: Create Milestones (NOT Tasks)

**Milestones are meaningful state transitions toward the outcome.**

From current codebase state â†’ outcome, identify 2-4 milestones:

```json
{
  "id": "m1",
  "name": "Auth infrastructure",
  "description": "User model, JWT utilities, middleware",
  "acceptance_criteria": [
    "User model with password hashing",
    "JWT sign/verify functions",
    "Auth middleware protecting routes"
  ],
  "status": "pending",
  "progress": 0
}
```

**Note:** Tasks are NOT pre-planned. `/next` dynamically generates tasks based on:
- Current codebase reality
- Milestone acceptance criteria
- Cross-goal priorities

## STEP 4: Present Intent for Approval

```
INTENT for: [goal-id] "[goal name]"

Wish: [wish]

Outcome (acceptance criteria):
- [criterion 1]
- [criterion 2]

Obstacles:
- [obstacle 1]

If-Then Rules:
- If [obstacle], then [action]

Milestones:
1. [m1] [name] - [acceptance criteria summary]
2. [m2] [name] - [acceptance criteria summary]
3. [m3] [name] - [acceptance criteria summary]

Deadline: [date] ([Y days from now])

Approve this intent?
```

## STEP 5: Save Intent

Add to agentc.json intents array:

```json
{
  "id": "i[next-number]",
  "goalId": "[goal-id]",
  "wish": "[wish]",
  "outcome": ["criterion 1", "criterion 2"],
  "obstacles": ["obstacle 1"],
  "ifThen": [{"if": "obstacle", "then": "action"}],
  "milestones": [
    {
      "id": "m1",
      "name": "...",
      "description": "...",
      "acceptance_criteria": ["..."],
      "status": "pending",
      "progress": 0
    }
  ],
  "deadline": "[ISO timestamp]",
  "status": "active",
  "created": "[ISO timestamp]"
}
```

## STEP 6: Confirm

```
Intent added: [intent-id] "[wish]"
For goal: [goal-id] "[goal direction]"

Milestones: X
Deadline: [date]

Run /next to get your first task (dynamically generated).
```

## Key Principles

- **WOOP methodology** for commitment
- **Milestones** define meaningful state transitions
- **NO pre-planned tasks** - /next generates them dynamically
- **One active intent per goal**
- **Ground in codebase reality**
