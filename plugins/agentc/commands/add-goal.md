---
description: "Add a new goal (WOOP commitment) with milestones toward a North Star"
arguments:
  - name: north-star-id
    description: "The North Star ID to add a goal for (e.g., ns1)"
    required: false
allowed-tools:
  - Read
  - Write
  - Edit
  - Glob
  - Grep
  - Bash
  - AskUserQuestion
---

You are adding a new GOAL to the AgentC system.

**Goals are concrete WOOP commitments with milestones. Tasks are dynamically generated by /next.**

## Directory Detection

Use `agentc/` as `$DIR`. Load `$DIR/agentc.json`.

## STEP 0: Load & Migrate Data

**AUTO-MIGRATION:** If old schema detected, migrate first:
- If `goals[]` exists but `northStars[]` doesn't: rename `goals` → `northStars`
- If `intents[]` exists: rename `intents` → `goals`
- Update all `goalId` references to `northStarId` in goals array
- Save and announce: "Migrated data schema: goals → northStars, intents → goals"

## STEP 1: Identify Target North Star

1. If north-star-id provided: Validate it exists in agentc.json northStars array
2. If no north-star-id provided:
   - Show active north stars
   - Ask user which north star this goal is for
3. **Check for existing active goal:**
   - If north star already has an active goal: Warn user
   - Only ONE active goal per north star at a time

## STEP 2: Analyze Codebase First

**Before gathering WOOP information:**
- Check for `stack.md` in project root
- Analyze current codebase state
- Understand what's implemented vs missing
- This grounds the goal in reality

**Announce:** "I'm analyzing the codebase to ground this goal in reality."

## STEP 3: Gather WOOP Information

Use AskUserQuestion (one question at a time):

1. **Wish**: What specific outcome do you want to achieve?
2. **Outcome**: What are the acceptance criteria? (done when statements)
3. **Obstacles**: What blocks might prevent success?
4. **Plan**: If-then contingency rules for each obstacle
5. **Deadline**: When must this be complete?

## STEP 4: Create Milestones (NOT Tasks)

**Milestones are meaningful state transitions toward the outcome.**

From current codebase state → outcome, identify 2-4 milestones:

```json
{
  "id": "m1",
  "name": "Auth infrastructure",
  "description": "User model, JWT utilities, middleware",
  "acceptance_criteria": [
    "User model with password hashing",
    "JWT sign/verify functions",
    "Auth middleware protecting routes"
  ],
  "status": "pending",
  "progress": 0
}
```

**Note:** Tasks are NOT pre-planned. `/next` dynamically generates tasks based on:
- Current codebase reality
- Milestone acceptance criteria
- Cross-goal priorities

## STEP 5: Present Goal for Approval

```
GOAL for: [north-star-id] "[north star name]"

Wish: [wish]

Outcome (acceptance criteria):
- [criterion 1]
- [criterion 2]

Obstacles:
- [obstacle 1]

If-Then Rules:
- If [obstacle], then [action]

Milestones:
1. [m1] [name] - [acceptance criteria summary]
2. [m2] [name] - [acceptance criteria summary]
3. [m3] [name] - [acceptance criteria summary]

Deadline: [date] ([Y days from now])

Approve this goal?
```

## STEP 6: Save Goal

Add to agentc.json goals array:

```json
{
  "id": "g[next-number]",
  "northStarId": "[north-star-id]",
  "wish": "[wish]",
  "outcome": ["criterion 1", "criterion 2"],
  "obstacles": ["obstacle 1"],
  "ifThen": [{"if": "obstacle", "then": "action"}],
  "milestones": [
    {
      "id": "m1",
      "name": "...",
      "description": "...",
      "acceptance_criteria": ["..."],
      "status": "pending",
      "progress": 0
    }
  ],
  "deadline": "[ISO timestamp]",
  "status": "active",
  "created": "[ISO timestamp]"
}
```

## STEP 7: Confirm

```
Goal added: [goal-id] "[wish]"
For North Star: [north-star-id] "[north star direction]"

Milestones: X
Deadline: [date]

Run /next to get your first task (dynamically generated).
```

## Key Principles

- **WOOP methodology** for commitment
- **Milestones** define meaningful state transitions
- **NO pre-planned tasks** - /next generates them dynamically
- **One active goal per north star**
- **Ground in codebase reality**
